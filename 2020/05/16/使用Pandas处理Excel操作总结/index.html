
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>使用Pandas处理Excel操作总结 | coding_life.log</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.17.1/styles/railscasts.css">
    <link rel="stylesheet" href="/lightx.css"/>
    <link rel="manifest" href="/manifest.json" />
    <link rel="apple-touch-icon" href="/icon512.png">
    <meta name="theme-color" content="#ffffff"/>
    
  <meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="coding_life.log" type="application/atom+xml">
</head>
  <body>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function () {
          navigator.serviceWorker.register('/sw.js', {scope: '/'})
            .then(function (registration) {
              // console.log('ServiceWorker registration successful with scope: ', registration.scope);
            })
            .catch(function (err) {
              console.log('ServiceWorker registration failed: ', err);
            });
        });
      }
    </script>
  <div id="page-container">
    <div id="content-wrap">
      <div class="wrapper">
        <div class="container">
            <nav>
    <ul>
      <li><a href="/">coding_life.log</a></li>
      <li><a href="/archives">Archives</a></li>
      <li><a href="/about">About</a></li>
    </ul>
</nav>

            <article>
  <h1>使用Pandas处理Excel操作总结</h1>
  <div class="contents">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#读取-Excel-文件"><span class="toc-text">读取 Excel 文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#保存-Excel-文件"><span class="toc-text">保存 Excel 文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#选取单元格内容"><span class="toc-text">选取单元格内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#读取某列所有元素"><span class="toc-text">读取某列所有元素</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#筛选"><span class="toc-text">筛选</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#统计"><span class="toc-text">统计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#修改"><span class="toc-text">修改</span></a></li></ol>
  </div>
  <p>去年年底从开发岗转到维护岗后，工作中需要处理大量的 Excel 表格，由于之前做开发的时候很少接触 Excel，对于它的认知也就是会使用 SUM 这些简单的公式，VBA 更是没有接触过了，面对大量的 Excel 文档和他们动辄几万行的数据，人工处理实在是太浪费时间了，还好之前自学过一点 Python，于是便开始了自我救赎之旅。</p>
<p>研究了 Python 几个可以用于处理 Excel 的模块之后，我最终选择了 Pandas 和 openpyxl</p>
<p>Pandas 主要用来处理数据，openpyxl 用于处理样式和保存文档。</p>
<p>这里只记录一下工作过程中经常用到的几个方法。</p>
<h2 id="读取-Excel-文件"><a href="#读取-Excel-文件" class="headerlink" title="读取 Excel 文件"></a>读取 Excel 文件</h2><p>读取 Excel 文件的方法是 <code>read_excel()</code></p>
<pre><code class="python">import pandas as pd
fd = pd.read_excel(&#39;Workbook.xlsx&#39;)
print(fd)</code></pre>
<p>第一个参数填写 Excel 文件的路径，第二个参数填写需要打开的标签页；第二个参数如果不填，则默认打开第一个标签页；<br>下面的脚本是读取 Sheet2 标签页。</p>
<pre><code class="python">fd = pd.read_excel(&#39;Workbook.xlsx&#39;, &#39;Sheet2&#39;)</code></pre>
<h2 id="保存-Excel-文件"><a href="#保存-Excel-文件" class="headerlink" title="保存 Excel 文件"></a>保存 Excel 文件</h2><p>保存 Excel 文件的方法方式 <code>to_excel()</code></p>
<pre><code class="python">fd.to_excel(&quot;Workbook_copy.xlsx&quot;)</code></pre>
<p>需要注意的是，保存的excel是不带样式的，所以我一般只用它来做测试查看结果是否符合预期，要输出可以交付的文档的时候，一般使用都是先使用 pandas 得到想要的数据，然后使用 openpyxl 保存。</p>
<p>另外，默认的保存方式得到的 Excel 表格是带有 index （可以简单理解为原始数据的行号，不过是以 0 开头）和 header （列标），如果不需要它，那么再后面加上参数 <code>index=None</code> 和 <code>header=None</code> 即可；</p>
<p>保存的默认标签页是 Sheet1，可以使用 <code>sheet_name</code>，参数来指定标签页名称。</p>
<pre><code class="python">fd.to_excel(&#39;Workbook_copy.xlsx, sheet_name=&quot;foo&quot;, index=None, header=None&#39;)</code></pre>
<h2 id="选取单元格内容"><a href="#选取单元格内容" class="headerlink" title="选取单元格内容"></a>选取单元格内容</h2><p>使用 <code>loc</code> 和 <code>iloc</code> 方法， 他们之间的区别是 <code>loc</code> 是基于标签， <code>iloc</code> 基于索引。</p>
<p>读取一行</p>
<pre><code class="python">fd.loc(1, :)</code></pre>
<p>读取一列</p>
<pre><code class="python">fd[&#39;列标签1&#39;]  # 通常的做法
fd.loc(:, [&#39;列标签1&#39;])  # 还可以这么做</code></pre>
<p>读取一行一列</p>
<pre><code class="python">fd.loc[3,[&#39;列标签1&#39;]]  # or
fd.iloc[3, 0]</code></pre>
<p>读取多行多列</p>
<pre><code class="python">fd.loc[[1, 3, 5], [&#39;列标签1&#39;, &#39;列标签2&#39;]]  # or
fd.iloc[[1, 3, 5], [0, 1]]</code></pre>
<h2 id="读取某列所有元素"><a href="#读取某列所有元素" class="headerlink" title="读取某列所有元素"></a>读取某列所有元素</h2><pre><code class="python">vals = fd.loc(&#39;列标签&#39;).to_list()</code></pre>
<h2 id="筛选"><a href="#筛选" class="headerlink" title="筛选"></a>筛选</h2><p>比如我们的表格中有一列的索引名称为“是否安装”，想选取值为 N 的数据：</p>
<pre><code class="python">data_y = data[data[&#39;是否安装&#39;] == &#39;N&#39;]</code></pre>
<p>使用 <code>&amp;</code> 和 <code>|</code> 可以使用更多的筛选条件，比如：</p>
<pre><code class="python">data_y = data[(data[&#39;是否安装&#39;] == &#39;Y&#39;) &amp; (data[&#39;用途&#39;] == &#39;效率&#39;)]</code></pre>
<p>对于更复杂的筛选条件，使用 <code>apply</code> ，先用简单的例子来说明一下，比如还是上文的选取索引值名称为“是否安装”里面 N 的数据，如果要用 <code>apply</code> 方法实现的话：</p>
<pre><code class="python">def IsInstalled(val):
    return val == &#39;N

data_y = data[data[&#39;是否安装&#39;].apply(IsInstalled)]</code></pre>
<p><code>apply</code> 可以带有参数，更为灵活</p>
<pre><code class="python">def IsInstalledArgs(val, is_install):
    return val == is_install

data_y = data[data[&#39;是否安装&#39;].apply(IsInstalledArgs, args=(&#39;N&#39;,))]</code></pre>
<h2 id="统计"><a href="#统计" class="headerlink" title="统计"></a>统计</h2><pre><code class="python">df.shape  # 返回数据的行列
df.count  # 返回每一列中非空值的个数
len(df[&#39;Column&#39;].index.values)  # 数据的条数</code></pre>
<h2 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h2><pre><code class="python">df.loc[3, &#39;列标签&#39;] = &#39;一个新值&#39;</code></pre>
<p>Pandas 还有很多方法，但以上方法对于我目前日常处理 Excel 数据的操作是够用的了，后面遇到了再补充吧。</p>

  
  <p class="copyright"><strong>Links: <a href="http://yoursite.com/2020/05/16/%E4%BD%BF%E7%94%A8Pandas%E5%A4%84%E7%90%86Excel%E6%93%8D%E4%BD%9C%E6%80%BB%E7%BB%93/">http://yoursite.com/2020/05/16/%E4%BD%BF%E7%94%A8Pandas%E5%A4%84%E7%90%86Excel%E6%93%8D%E4%BD%9C%E6%80%BB%E7%BB%93/</a></strong></p>  
</article>

<div id="comment">
    
</div>
        </div>
      </div>
    </div>
    <div id="footer">
      <div class="wrapper">
        <div class="container">
          
<button id="back-top" onclick="window.scrollTo({top:0,behavior:'smooth'})">TOP</button>
<footer>
    <div>
        <p>
            © 2020 <a href="http://yoursite.com">antisamael</a>.
            Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>.
            Theme <a href="https://github.com/songquanpeng/hexo-theme-lightx" target="_blank" rel="noopener">lightx</a>.
            
        </p>
    </div>
</footer>

        </div>
      </div>
    </div>
  </div>
  
  
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@latest/build/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  </body>
</html>
